<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HNSW & TOS Vectors - 分层向量存储演示</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- AWS 风格顶部导航栏 -->
    <header class="aws-header">
        <div class="header-content">
            <div class="header-left">
                <span class="service-name">TOS Vector Storage</span>
                <span class="separator">|</span>
                <span class="page-title">HNSW 分层存储演示</span>
            </div>
            <div class="header-right">
                <span class="region">Region: cn-beijing</span>
            </div>
        </div>
    </header>

    <!-- 主容器 -->
    <div class="main-container">
        <!-- 左侧控制面板 -->
        <aside class="control-panel">
            <div class="panel-section">
                <h3>系统状态</h3>
                <div style="margin-bottom: 12px; padding: 12px; background-color: #f0f9ff; border-radius: 4px; border: 1px solid #0073bb;">
                    <div style="font-size: 13px; color: #0073bb; font-weight: 700; margin-bottom: 4px;">自动插入</div>
                    <div id="autoInsertStatus" style="font-size: 12px; color: #545b64;">运行中 (5-10秒随机间隔)</div>
                </div>
                <div style="padding: 12px; background-color: #f0f9ff; border-radius: 4px; border: 1px solid #0073bb;">
                    <div style="font-size: 13px; color: #0073bb; font-weight: 700; margin-bottom: 4px;">自动 Flush</div>
                    <div style="font-size: 12px; color: #545b64;">每分钟整点检查，保留最近 2 个时间窗口</div>
                </div>
            </div>

            <div class="panel-section">
                <h3>查询测试</h3>
                <label>查询向量 (4维):</label>
                <input type="text" id="queryVector" class="aws-input" placeholder="留空则随机生成">
                <label>查询时间窗口:</label>
                <select id="timeWindow" class="aws-input">
                    <option value="current">当前窗口 (HNSW)</option>
                </select>
                <label>Top-K 结果数:</label>
                <select id="topK" class="aws-input">
                    <option value="1" selected>Top 1</option>
                    <option value="2">Top 2</option>
                    <option value="3">Top 3</option>
                </select>
                <button id="executeQuery" class="aws-button primary">执行查询</button>
            </div>

            <div class="panel-section">
                <h3>统计信息</h3>
                <div class="stats">
                    <div class="stat-item">
                        <span class="stat-label">HNSW 向量数:</span>
                        <span id="hnswCount" class="stat-value">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">TOS Indexes:</span>
                        <span id="tosIndexCount" class="stat-value">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">总向量数:</span>
                        <span id="totalCount" class="stat-value">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">下次 Flush:</span>
                        <span id="nextFlush" class="stat-value">60s</span>
                    </div>
                </div>
                <div style="margin-top: 16px;">
                    <h4 style="font-size: 13px; margin-bottom: 8px; color: #545b64;">HNSW 按分钟分布:</h4>
                    <div id="hnswMinuteStats" style="font-size: 12px; color: #687078;"></div>
                </div>
            </div>
        </aside>

        <!-- 右侧可视化区域 -->
        <main class="visualization-area">
            <!-- HNSW 图可视化 -->
            <section class="viz-section">
                <div class="section-header">
                    <h2>HNSW 索引 (内存层)</h2>
                    <span class="badge">实时</span>
                </div>
                <div id="windowLegend" style="margin-bottom: 12px; padding: 12px; background-color: #fafafa; border: 1px solid #eaeded; border-radius: 4px; display: flex; flex-wrap: wrap; gap: 12px; align-items: center;">
                    <span style="font-size: 13px; font-weight: 700; color: #545b64;">时间窗口:</span>
                </div>
                <div style="margin-bottom: 12px; padding: 12px; background-color: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; display: flex; gap: 12px; align-items: center;">
                    <span style="font-size: 13px; font-weight: 700; color: #856404;">显示层级:</span>
                    <label style="display: flex; align-items: center; gap: 6px; cursor: pointer;">
                        <input type="radio" name="layerView" value="0" checked style="cursor: pointer;">
                        <span style="font-size: 12px; color: #856404;">层 0</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 6px; cursor: pointer;">
                        <input type="radio" name="layerView" value="1" style="cursor: pointer;">
                        <span style="font-size: 12px; color: #856404;">层 1</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 6px; cursor: pointer;">
                        <input type="radio" name="layerView" value="2" style="cursor: pointer;">
                        <span style="font-size: 12px; color: #856404;">层 2</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 6px; cursor: pointer;">
                        <input type="radio" name="layerView" value="all" style="cursor: pointer;">
                        <span style="font-size: 12px; color: #856404;">所有层</span>
                    </label>
                </div>
                <div id="hnswGraph" class="graph-container"></div>
                <div id="vectorDetail" class="vector-detail hidden">
                    <h4>向量详情</h4>
                    <div id="vectorInfo"></div>
                </div>
            </section>

            <!-- TOS Vector Bucket 可视化 -->
            <section class="viz-section">
                <div class="section-header">
                    <h2>TOS Vector Bucket (持久化层)</h2>
                    <span class="badge secondary">归档</span>
                </div>
                <div id="tosBucket" class="bucket-container"></div>
            </section>

            <!-- 查询结果展示 -->
            <section class="viz-section" id="queryResultSection" style="display: none;">
                <div class="section-header">
                    <h2>查询结果</h2>
                </div>
                <div id="queryResult" class="query-result"></div>
            </section>
        </main>
    </div>

    <!-- 通知提示 -->
    <div id="notification" class="notification hidden"></div>

    <script src="app.js"></script>
</body>
</html>
